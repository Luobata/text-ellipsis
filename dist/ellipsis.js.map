{"version":3,"file":"ellipsis.js","sources":["../node_modules/text-ellipsis-core/src/index.js","../src/ellipsis/config.js","../src/ellipsis/ellipsis.vue","../src/index_global.js"],"sourcesContent":["// const getLengthByCanvas = (ctx, font = {}) => {\n//     const weight = font.fontWeight;\n//     const size = font.fontSize;\n//     const family = font.fontFamily;\n//     ctx.font = `${weight} ${size} ${family}`;\n\n//     return ctx.measureText(font.value).width;\n// };\nconst getLengthByDom = (span, font = {}) => {\n    // TODO 增加style样式\n    span.innerText = font.value;\n    return span.offsetWidth;\n};\n\nexport default (font = {}, span) => {\n    let beginLine = 1;\n    let index = 0;\n    const line = [];\n\n    for (let i = 0; i <= font.text.length; i++) {\n        if (beginLine > font.lineNum) break;\n        const left = beginLine === parseInt(font.lineNum, 10) ? font.left : '';\n        const str = font.text.substr(index, i - index) + left;\n        const len = getLengthByDom(\n            span,\n            Object.assign({ value: str }, font),\n        );\n        // console.log(str, len);\n        if (len <= parseFloat(font.width, 10)) {\n            line[beginLine - 1] = str;\n        } else {\n            i--;\n            beginLine++;\n            index = i;\n        }\n    }\n\n    return line;\n};\n","export const userConfig = {\n    width: '50px',\n    lineNum: 2,\n    fontFamily: 'microsoft yahei',\n    fontWeight: 'bold',\n    fontSize: '14px',\n    left: '...',\n    tagName: 'p',\n    isImmediate: true,\n};\n\nexport const assignConfig = (conf) => {\n    Object.assign(userConfig, conf);\n};\n","<template lang=\"pug\">\n    div.ellipsis-wrap\n        p.ellipsis(v-for=\"item in textArr\") {{ item }}\n        p.ellipsis(v-if=\"tagName === 'p'\" v-for=\"item in textArr\") {{ item }}\n        span.ellipsis(v-if=\"tagName === 'span'\" v-for=\"item in textArr\") {{ item }}\n        li.ellipsis(v-if=\"tagName === 'li'\" v-for=\"item in textArr\") {{ item }}\n</template>\n<style lang=\"styl\">\n</style>\n<script>\n    //import core from './core';\n    import core from 'text-ellipsis-core';\n    import { userConfig } from './config';\n\n    export default {\n        name: 'ellipsis',\n        props: {\n            text: {\n                type: String,\n                default: '',\n            },\n            width: {\n                type: String,\n            },\n            //lineHeight: {\n            //    type: String,\n            //    default: '14px',\n            //},\n            lineNum: {\n                type: Number,\n            },\n            fontFamily: {\n                type: String,\n            },\n            fontWeight: {\n                type: String | Number,\n            },\n            fontSize: {\n                type: String,\n            },\n            left: {\n                type: String,\n            },\n            tagName: {\n                type: String,\n                default: userConfig.tagName,\n            },\n            isImmediate: {\n                type: Boolean,\n                default: userConfig.isImmediate,\n            },\n        },\n        data() {\n            return {\n                textArr: [],\n                span: '',\n                parentWidth: '',\n            };\n        },\n        watch: {\n            width: function () {\n                this.update();\n            }\n        },\n        methods: {\n            init() {\n                // 初始化\n                this.span  = document.createElement('span');\n                this.span.style.opacity = 0;\n                this.span.style['white-space'] = 'nowrap';\n                this.span.style['font-weight'] = this.fontWeight || userConfig.fontWeight;\n                this.span.style['font-family'] = this.fontFamily || userConfig.fontFamily;\n                this.span.style['font-size'] = this.fontSize|| userConfig.fontSize;\n                document.body.append(this.span);\n                const font = {\n                    text: this.text,\n                    width: this.parentWidth || parseFloat(getComputedStyle(this.$el.parentElement).width, 10),\n                    lineHeight: this.lineHeight || userConfig.lineHeight,\n                    lineNum: this.lineNum || userConfig.lineNum,\n                    fontFamily: this.fontFamily || userConfig.fontFamily,\n                    fontSize: this.fontSize || userConfig.fontSize,\n                    fontWeight: this.fontWeight || userConfig.fontWeight,\n                    left: this.left || userConfig.left,\n                };\n                this.textArr = core(font, this.span);\n                this.destory();\n            },\n            destory() {\n                this.span.remove();\n                this.span = '';\n            },\n            update() {\n                this.init();\n            },\n        },\n        beforeMount() {\n            if (this.width) {\n                this.parentWidth = this.width;\n                this.init();\n            }\n        },\n        mounted() {\n            if (!this.width) {\n                this.parentWidth = parseFloat(getComputedStyle(this.$el.parentElement).width, 10);\n                this.init();\n                const min = 1000;\n                let timeout;\n                let begin = new Date().getTime();\n                const that = this;\n                window.addEventListener('resize', () => {\n                    if (that.parentWidth === parseFloat(getComputedStyle(this.$el.parentElement).width, 10)) return;\n                    that.parentWidth = parseFloat(getComputedStyle(this.$el.parentElement).width, 10);\n                    if (that.isImmediate) {\n                        that.init();\n                    } else {\n                        const now = new Date().getTime();\n                        if (now - begin < min) {\n                            timeout = setTimeout(() => {\n                                that.init.call(that);\n                                begin = now;\n                            }, now - begin);\n                        } else {\n                            timeout = null;\n                            clearTimeout(timeout);\n                            that.init();\n                            begin = now;\n                        }\n                    }\n                });\n            }\n        },\n        destroyed() {\n        },\n    };\n</script>\n","import app from './ellipsis/ellipsis.vue';\nimport { assignConfig } from './ellipsis/config';\n\nconst install = (Vue, conf) => {\n    Vue.component(app.name, app);\n    if (conf) {\n        assignConfig(conf);\n    }\n};\n\n/* istanbul ignore if */\nif (typeof window !== 'undefined' && window.Vue) {\n    install(window.Vue);\n}\n\nexport default {\n    install,\n};\n// module.exports = {\n//    install\n// };\n"],"names":["userConfig","assignConfig","conf","assign","String","Number","tagName","Boolean","isImmediate","update","span","document","createElement","style","opacity","fontWeight","fontFamily","fontSize","body","append","font","text","parentWidth","parseFloat","getComputedStyle","$el","parentElement","width","lineHeight","lineNum","left","textArr","core","destory","remove","init","min","timeout","begin","Date","getTime","that","addEventListener","now","setTimeout","call","install","Vue","component","app","name","window"],"mappings":"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"}